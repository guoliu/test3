"use strict";(()=>{var f='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>',y='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg>';function p(){if(!document.body.classList.contains("immersive-ready"))return;let s=document.querySelector("main > article.container");if(!s)return;let o=s.querySelector(":scope > iframe");if(!o)return;let e=document.createElement("div");e.className="immersive-iframe-wrapper";let n=document.createElement("button");n.type="button",n.className="immersive-fullscreen-btn",n.setAttribute("aria-label","Enter fullscreen"),n.innerHTML=f,o.parentNode.insertBefore(e,o),e.appendChild(o),e.appendChild(n);let i=!1,l=null;function d(){if(i)return;let t=e.getBoundingClientRect();l=t,document.body.classList.add("immersive-fs-active"),i=!0,n.innerHTML=y,n.setAttribute("aria-label","Exit fullscreen");let c=e.getBoundingClientRect(),g=t.left-c.left,m=t.top-c.top,h=c.width>0?t.width/c.width:1,u=c.height>0?t.height/c.height:1;e.style.transform=`translate(${g}px, ${m}px) scale(${h}, ${u})`,requestAnimationFrame(()=>{e.classList.add("fs-animating-enter"),e.style.transform="";function v(M){M.propertyName==="transform"&&(e.removeEventListener("transitionend",v),e.classList.remove("fs-animating-enter"))}e.addEventListener("transitionend",v)})}function a(){if(!i||!l)return;let t=e.getBoundingClientRect(),c=l.left-t.left,g=l.top-t.top,m=t.width>0?l.width/t.width:1,h=t.height>0?l.height/t.height:1;e.classList.add("fs-animating-exit"),e.style.transform=`translate(${c}px, ${g}px) scale(${m}, ${h})`;function u(v){v.propertyName==="transform"&&(e.removeEventListener("transitionend",u),e.classList.remove("fs-animating-exit"),e.style.transform="",document.body.classList.remove("immersive-fs-active"),i=!1,n.innerHTML=f,n.setAttribute("aria-label","Enter fullscreen"))}e.addEventListener("transitionend",u)}function r(){i?a():d()}n.addEventListener("click",t=>{t.stopPropagation(),r()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&i&&(a(),t.preventDefault())}),window.addEventListener("message",t=>{t.data?.type==="moss-escape-key"&&i&&a()})}function L(){let s=document.documentElement,e=s.getAttribute("data-theme")==="dark"?"light":"dark";s.setAttribute("data-theme",e),localStorage.setItem("theme",e);let n=document.querySelector(".theme-toggle");n&&n.classList.toggle("theme-toggle--toggled",e==="dark")}function b(){let s=document.querySelector(".nav-links");s&&s.classList.toggle("mobile-open")}window.toggleTheme=L;window.toggleMobileMenu=b;document.addEventListener("click",function(s){let o=document.querySelector(".nav-links"),e=document.querySelector(".mobile-menu-button");if(o&&e&&o.classList.contains("mobile-open")){let n=s.target;!o.contains(n)&&!e.contains(n)&&o.classList.remove("mobile-open")}});function w(s,o){try{let e=document.createElement("canvas"),n=e.getContext("2d");if(!n){o(null);return}let i=10;e.width=i,e.height=i,n.drawImage(s,0,0,i,i);let d=n.getImageData(0,0,i,i).data,a=0,r=0,t=0,c=0;for(let u=0;u<d.length;u+=4)a+=d[u],r+=d[u+1],t+=d[u+2],c++;a=Math.round(a/c),r=Math.round(r/c),t=Math.round(t/c);let g=(a+r+t)/3,m=.6;a=Math.round(a*m+g*(1-m)),r=Math.round(r*m+g*(1-m)),t=Math.round(t*m+g*(1-m));let h=.7;a=Math.round(a*h),r=Math.round(r*h),t=Math.round(t*h),o(`rgb(${a}, ${r}, ${t})`)}catch{o(null)}}function E(){document.querySelectorAll(".collection-card").forEach(o=>{let e=o.querySelector(".collection-card-cover"),n=o.querySelector(".collection-card-content");if(!e||!n)return;let l=e.getAttribute("style")?.match(/url\(['"]?([^'"]+)['"]?\)/);if(!l)return;let d=new Image;d.crossOrigin="anonymous",d.onload=()=>{w(d,a=>{a&&(n.style.backgroundColor=a,n.style.color="rgba(255, 255, 255, 0.95)")})},d.src=l[1]})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E();(function(){let s=window.matchMedia&&window.matchMedia("(prefers-color-scheme)").media!=="not all",o=!1;if(s)try{let i=window.matchMedia("(prefers-color-scheme: dark)");o=i.matches,i.addEventListener("change",function(l){if(!localStorage.getItem("theme")){let a=l.matches?"dark":"light";document.documentElement.setAttribute("data-theme",a);let r=document.querySelector(".theme-toggle");r&&r.classList.toggle("theme-toggle--toggled",a==="dark")}})}catch{o=!1}let n=localStorage.getItem("theme")||(o?"dark":"light");document.documentElement.setAttribute("data-theme",n),n==="dark"&&requestAnimationFrame(()=>{let i=document.querySelector(".theme-toggle");i&&i.classList.add("theme-toggle--toggled")})})();p();})();
